# エンタメEC 請求書作成システム - 機能一覧

## 📋 システム概要

ECサイトの売上データとWMS（倉庫管理システム）の出荷データを統合し、請求書を自動作成するシステムです。

**本番URL**: https://ec-kanri2.pages.dev

---

## ✅ 実装済み機能

### STEP1: マスタ管理

| 機能 | 状態 | 説明 |
|------|------|------|
| ECサイトマスタ | ✅ 完了 | ECサイトの登録・編集・削除。商品CSVに案件情報があるかのフラグ設定 |
| 倉庫マスタ | ✅ 完了 | 倉庫の登録・編集・削除 |
| 請求区分マスタ | ✅ 完了 | 請求区分（通常請求、特別請求など）の登録・編集・削除 |
| 請求項目マスタ | ✅ 完了 | 請求書に表示する項目（倉庫保管料、出荷作業料など）の登録・編集・削除 |
| 商品CSVマスタ | ✅ 完了 | ECサイトごとのCSV列マッピング設定（案件列、商品コード列など） |
| WMS CSVマスタ | ✅ 完了 | WMSごとのCSV列マッピング設定（受注番号列、数量列など） |

### STEP2: クライアント管理

| 機能 | 状態 | 説明 |
|------|------|------|
| クライアント一覧 | ✅ 完了 | 登録済みクライアントの一覧表示・検索・削除 |
| クライアント登録 | ✅ 完了 | 会社情報、担当者、銀行口座情報の登録・編集 |
| 担当者管理 | ✅ 完了 | 複数担当者の追加・削除、請求書送付先フラグ |
| 有効/無効切替 | ✅ 完了 | クライアントの有効/無効ステータス管理 |

### STEP3: 案件管理

| 機能 | 状態 | 説明 |
|------|------|------|
| 案件一覧 | ✅ 完了 | 登録済み案件の一覧表示・検索・削除 |
| 案件登録 | ✅ 完了 | クライアント紐付け、案件名、期間、手数料率の設定 |
| 倉庫・請求区分紐付け | ✅ 完了 | 案件ごとに使用する倉庫と請求区分を設定 |

### STEP4: データ取込

| 機能 | 状態 | 説明 |
|------|------|------|
| 商品データCSV取込 | ✅ 完了 | ECサイトの商品マスタCSVをアップロード・登録 |
| WMSデータCSV取込 | ✅ 完了 | WMSの出荷データCSVをアップロード・登録 |
| データ一覧表示 | ✅ 完了 | 取り込んだデータの確認 |
| 対象年月指定 | ✅ 完了 | 取込データの対象年月を指定 |

### STEP5: 請求管理

| 機能 | 状態 | 説明 |
|------|------|------|
| 請求書作成（案件集計） | ✅ 完了 | クライアント・案件・対象月を選択して請求書作成 |
| 振込明細書タブ | ✅ 完了 | 売上金額、販売手数料、振込金額の表示 |
| 請求書タブ | ✅ 完了 | 倉庫保管料、出荷作業料、消費税を含む明細表示 |
| 通販売上金額明細書タブ | ✅ 完了 | 商品代金、出荷件数、平均客単価の表示 |
| 請求書一覧 | ✅ 完了 | 発行済み請求書の一覧表示 |
| イレギュラー請求登録 | ✅ 完了 | 通常外の請求データを手動登録 |

### その他

| 機能 | 状態 | 説明 |
|------|------|------|
| ダッシュボード | ✅ 完了 | 登録数の統計表示、次のアクション提案 |
| サイドバーナビ | ✅ 完了 | STEP順に整理されたメニュー |
| レスポンシブ対応 | ✅ 完了 | PC・タブレット対応 |
| エラーハンドリング | ✅ 完了 | API エラー時の適切なメッセージ表示 |

---

## 🚧 未実装・今後の機能

| 機能 | 優先度 | 説明 |
|------|--------|------|
| 請求書PDF出力 | 高 | 請求書をPDF形式でダウンロード |
| 請求書メール送信 | 高 | 担当者へ請求書を自動メール送信 |
| ユーザー認証 | 高 | ログイン機能、権限管理 |
| 日次売上レポート | 中 | 日ごとの売上集計レポート |
| CSVエクスポート | 中 | データのCSV出力機能 |
| 検索機能強化 | 中 | 部分一致検索、複合条件検索 |
| 監査ログ | 低 | 操作履歴の記録 |
| モバイル最適化 | 低 | スマートフォン向けUI |

---

## 🗄️ データベース構造

```
┌─────────────────┐     ┌─────────────────┐
│    EcSite       │     │   Warehouse     │
│  (ECサイト)      │     │    (倉庫)       │
└─────────────────┘     └─────────────────┘

┌─────────────────┐     ┌─────────────────┐
│ BillingCategory │     │  BillingItem    │
│  (請求区分)      │     │  (請求項目)      │
└─────────────────┘     └─────────────────┘

┌─────────────────┐     ┌─────────────────┐
│ ProductCsvMaster│     │  WmsCsvMaster   │
│ (商品CSVマスタ)  │     │ (WMS CSVマスタ) │
└─────────────────┘     └─────────────────┘

┌─────────────────┐
│     Client      │──────┐
│  (クライアント)   │      │
└─────────────────┘      │
         │               │
         ▼               │
┌─────────────────┐      │
│ ClientContact   │      │
│   (担当者)       │      │
└─────────────────┘      │
                         │
┌─────────────────┐      │
│    Project      │◀─────┘
│    (案件)        │
└─────────────────┘
         │
         ▼
┌─────────────────┐     ┌─────────────────┐
│    Product      │     │    WmsData      │
│    (商品)        │     │  (WMSデータ)    │
└─────────────────┘     └─────────────────┘
         │                      │
         └──────────┬───────────┘
                    ▼
         ┌─────────────────┐
         │    Invoice      │
         │   (請求書)       │
         └─────────────────┘
```

---

## 🛠️ 技術スタック

| カテゴリ | 技術 |
|---------|------|
| フレームワーク | Next.js 15 (App Router) |
| 言語 | TypeScript |
| スタイリング | Tailwind CSS |
| データベース | Cloudflare D1 (SQLite互換) |
| ORM | Prisma |
| ホスティング | Cloudflare Pages |
| リポジトリ | GitHub |

---

## 📱 画面一覧

| パス | 画面名 |
|------|--------|
| `/` | ホーム（ダッシュボード） |
| `/master/ec-sites` | ECサイトマスタ |
| `/master/warehouses` | 倉庫マスタ |
| `/master/billing-categories` | 請求区分マスタ |
| `/master/billing-items` | 請求項目マスタ |
| `/master/product-csv` | 商品CSVマスタ |
| `/master/wms-csv` | WMS CSVマスタ |
| `/clients` | クライアント一覧 |
| `/clients/register` | クライアント登録・編集 |
| `/projects` | 案件一覧 |
| `/projects/register` | 案件登録・編集 |
| `/products/register` | 商品データCSV取込 |
| `/wms/register` | WMSデータCSV取込 |
| `/billing/summary` | 請求書作成（案件集計） |
| `/billing/invoices` | 請求書一覧 |
| `/billing/irregular` | イレギュラー請求登録 |

---

## 📝 使い方（クイックスタート）

### 1. マスタ登録
1. ECサイトマスタで「テストECサイト」を登録
2. 倉庫マスタで「テスト倉庫」を登録
3. 請求区分マスタで「通常請求」を登録

### 2. クライアント登録
1. クライアント登録画面で会社情報を入力
2. 担当者を追加（請求書送付先にチェック）
3. 銀行口座情報を入力して保存

### 3. 案件登録
1. 案件登録画面でクライアントを選択
2. 案件名、手数料率を入力
3. 倉庫と請求区分を選択して保存

### 4. データ取込
1. 商品データCSV取込でECサイトの商品CSVをアップロード
2. WMSデータCSV取込で出荷データCSVをアップロード

### 5. 請求書作成
1. 請求書作成画面でクライアント・案件・対象月を選択
2. 各タブで明細を確認
3. 「登録」ボタンで請求書を発行

---

*最終更新: 2024年12月17日*
